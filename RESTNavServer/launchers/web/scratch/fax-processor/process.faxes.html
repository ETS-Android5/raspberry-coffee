<!DOCTYPE html>
<!--
 | This is a test, WiP.
 | Faxes from the Internet, rotated and re-scaled
 | 
 | copyright OlivSoft, c'est MOI qui l'ai fait.
 +-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
    <title>Atlantic Faxes</title>
    <link rel="icon" type="image/ico" href="./hammerhead.02.ico">
    <link rel="stylesheet" href="./white.css" type="text/css"/>
    <style type="text/css">
      .fax-container {
        display: none;
      }
    </style>
    <script type="text/javascript">
        showSurface = (cb) => {
          let left = document.getElementById("left-img-canvas");
          let right = document.getElementById("right-img-canvas");
          right.style.display = cb.checked ? 'inline' : 'none';
          left.style.display = cb.checked ? 'inline' : 'none';
        };
        show500mb = (cb) => {
          let fax500mb = document.getElementById("north-img-canvas");
          fax500mb.style.display = cb.checked ? 'inline' : 'none';
        };
        showWaves = (cb) => {
          let faxWaves = document.getElementById("waves-img-canvas");
          faxWaves.style.display = cb.checked ? 'inline' : 'none';
        };
    </script>
</head>
<body>
  <h2>Altantic faxes from the Internet</h2>

<!-- North-West Atlantic: https://tgftp.nws.noaa.gov/fax/PYAA12.gif -->
<!-- North-East Atlantic: https://tgftp.nws.noaa.gov/fax/PYAA11.gif -->
<!-- North Atlantic 500mb: https://tgftp.nws.noaa.gov/fax/PPAA10.gif -->
<!-- North Atlantic Sea State: https://tgftp.nws.noaa.gov/fax/PJAA99.gif -->

  <!-- TODO Values for the faxes position (CSS width, margins, etc) ? -->
  <!-- 
    This div is NOT displayed.
    It holds the images to be transformed.
  -->
  <div id="placeholder" class="fax-container" style="min-height: 600px; min-width: 1024px; padding-top: 40px;">
      <img id="left" src="NW-Atl.gif"></img>
      <img id="right" src="NE-Atl.gif"></img>
      <img id="500mb" src="N-Atl-500mb.gif"></img>
      <img id="waves" src="N-Atl-waves.gif"></img>
  </div>
  <!--
    This one holds the TRANSFORMED images
  -->
  <div> <!-- style="position: absolute; top: 50px; left: 90px; min-height: 600px; min-width: 1024px; padding-top: 40px;"> -->
      <canvas id="left-img-canvas" style="position: absolute; top: 50px; left: 50px; z-index: 0;"></canvas>
      <canvas id="right-img-canvas" style="position: absolute; top: 50px; left: 50px; z-index: 1;"></canvas>
      <canvas id="north-img-canvas" style="position: absolute; top: 50px; left: 50px; z-index: 2;"></canvas>
      <canvas id="waves-img-canvas" style="position: absolute; top: 50px; left: 50px; z-index: 3;"></canvas>
  </div>
  <div style="padding-top: 0px;">
      <input type="checkbox" id="show-surface" onchange="showSurface(this);" checked> Show Surface Faxes<br/>
      <input type="checkbox" id="show-500mb" onchange="show500mb(this);" checked> Show 500mb Fax<br/>
      <input type="checkbox" id="show-waves" onchange="showWaves(this);" checked> Show Sea State<br/>
  </div>
</body>
<script type="text/javascript">

    const TO_RED = 1;
    const TO_BLUE = 2;
    const TO_GREEN = 3;

    messWithCanvas = (img, canvasName, changeBlackTo) => {
      const canvas = document.getElementById(canvasName);
      let ctx = canvas.getContext("2d");

      canvas.width = img.width;
      canvas.height = img.height;

      ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight, 0, 0, img.width, img.height);

      originalPixels = ctx.getImageData(0, 0, img.width, img.height);
      currentPixels = ctx.getImageData(0, 0, img.width, img.height);

      let pix = originalPixels.data;
      // console.log(`There are ${pix.length} pixels.`);

      for (let idx=0; idx<pix.length; idx+=4) { // 4 by 4, rgba.
        let r = pix[idx];       // Red
        let g = pix[idx + 1];   // Green
        let b = pix[idx + 2];   // Blue
        let a = pix[idx + 3];   // Alpha
        // console.log(`rgba(${r},${g},${b},${a})`);
        if (r === 0 && b === 0 && g === 0) { // black
          if (changeBlackTo === TO_RED) {
            r = 255;  // Change black to red
          } else if (changeBlackTo === TO_BLUE) {
            b = 255;  // Change black to blue
          } else if (changeBlackTo === TO_GREEN) {
            // 47, 79, 47
            // Change black to green
            r = 47;
            g = 79;
            b = 47;
          }
        } else if (r === 255 && b === 255 && g === 255) { // white
          a = 0;    // Make white transparent
        }
        currentPixels.data[idx] = r;
        currentPixels.data[idx + 1] = g;
        currentPixels.data[idx + 2] = b;
        currentPixels.data[idx + 3] = a;
      }
      ctx.putImageData(currentPixels, 0, 0);  // Bam!
    };

    window.onload = () => {
      const leftFax = document.getElementById('left');
      const rightFax = document.getElementById('right');
      const fax500mb = document.getElementById('500mb');
      const faxWaves = document.getElementById('waves');

      messWithCanvas(leftFax, 'left-img-canvas', TO_RED);
      const leftReworkedFax = document.getElementById('left-img-canvas');
      leftReworkedFax.style.width = '600px';
      leftReworkedFax.style.height = 'auto';
      leftReworkedFax.style.transform = 'rotate(90deg)';
      // leftReworkedFax.style.marginLeft = '0px';
      leftReworkedFax.style.top = '160px';
      leftReworkedFax.style.left = '125px';

      messWithCanvas(rightFax, 'right-img-canvas', TO_RED);
      const rightReworkedFax = document.getElementById('right-img-canvas');
      rightReworkedFax.style.width = '600px';
      rightReworkedFax.style.height = 'auto';
      rightReworkedFax.style.transform = 'rotate(90deg)';
      // rightReworkedFax.style.marginLeft = '-188px';
      rightReworkedFax.style.top = '160px';
      rightReworkedFax.style.left = '541px';

      messWithCanvas(fax500mb, 'north-img-canvas', TO_BLUE);
      const northReworkedFax = document.getElementById('north-img-canvas');
      northReworkedFax.style.width = '919px';
      northReworkedFax.style.height = 'auto';
      northReworkedFax.style.transform = 'rotate(0deg)';
      // northReworkedFax.style.marginLeft = '62px';
      // northReworkedFax.style.marginTop = '-537px';
      northReworkedFax.style.top = '129px';
      northReworkedFax.style.left = '187px';

      messWithCanvas(faxWaves, 'waves-img-canvas', TO_GREEN);
      const waveshReworkedFax = document.getElementById('waves-img-canvas');
      waveshReworkedFax.style.width = '919px';
      waveshReworkedFax.style.height = 'auto';
      waveshReworkedFax.style.transform = 'rotate(0deg)';
      // waveshReworkedFax.style.marginLeft = '62px';
      // waveshReworkedFax.style.marginTop = '-537px';
      waveshReworkedFax.style.top = '129px';
      waveshReworkedFax.style.left = '187px';

  };
</script>
</html>
