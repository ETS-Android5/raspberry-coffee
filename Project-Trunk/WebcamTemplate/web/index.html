<!DOCTYPE html>
<html lang="en">
<!--
 ! Uses ES6 Promises to get to Ajax
 +-->
<head>
	<meta charset="UTF-8">
	<title>Snapshot</title>
	<link rel="icon" type="image/png" href="./camera.png">
	<link rel="stylesheet" href="./stylesheet.css" type="text/css"/>

	<style type="text/css">
		body {
			color: white;
			background: black;
		}
	</style>
	<script type="text/javascript" src="./ajax.manager.js"></script> <!-- Contains REST calls -->

	<script type="text/javascript">

		let oneOrTwo = 1; // flip-flap

		function updateImage() {
			fetchPix(json => {
				// console.log("Got this:", json);
				let imgUrl = location.protocol + '//' + location.host + '/' + json.snapUrl +
				  `?${Math.random()}`; // To force a refresh, un-cached URL...

				let visibleDiv = (oneOrTwo === 1) ? document.getElementById("the-picture-1") : document.getElementById("the-picture-2");
				let hiddenDiv = (oneOrTwo === 1) ? document.getElementById("the-picture-2") : document.getElementById("the-picture-1");
				visibleDiv.innerHTML =
						`<img src="${imgUrl}" title="Snap!"/>`;
				window.setTimeout(() => { // To avoid flickering...
					visibleDiv.style.display = 'block';
					hiddenDiv.style.display = 'none';
					oneOrTwo = (oneOrTwo === 1 ? 2 : 1);
				}, 500);
			});
		}

		function buttonClicked() {
			updateImage();
		}

		let interval = undefined;
		function loop(cb) {
			// console.log("Loop function:", cb, cb.checked);
			if (cb.checked) {
				interval = window.setInterval(() => {
					updateImage();
				}, 2000);
			} else {
				window.clearInterval(interval);
			}
		}
	</script>
</head>
<body>

	<h1>Raspberry Snap</h1>

	<button onclick="buttonClicked();">Refresh</button> &nbsp; <input type="checkbox" onchange="loop(this);"> Loop.
	<div id="the-picture-1" style="display: none;"></div>
	<div id="the-picture-2" style="display: none;"></div>

	<hr/>
	<address>&copy; OlivSoft, 2020</address>
</body>
</html>
